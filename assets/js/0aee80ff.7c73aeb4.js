"use strict";(self.webpackChunkepinio_docusaurus=self.webpackChunkepinio_docusaurus||[]).push([[77923],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return f}});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),f=o,m=d["".concat(s,".").concat(f)]||d[f]||u[f]||i;return n?r.createElement(m,a(a({ref:t},p),{},{components:n})):r.createElement(m,a({ref:t},p))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var c=2;c<i;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},51332:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return f},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return u}});var r=n(83117),o=n(80102),i=(n(67294),n(3905)),a=["components"],l={sidebar_label:"Provisioning Of An External IP Address For Local Kubernetes",sidebar_position:5,title:""},s=void 0,c={unversionedId:"howtos/customization/provision_external_ip_for_local_kubernetes",id:"version-1.10.0/howtos/customization/provision_external_ip_for_local_kubernetes",title:"",description:"Provision of External IP for LoadBalancer service type in Kubernetes",source:"@site/versioned_docs/version-1.10.0/howtos/customization/provision_external_ip_for_local_kubernetes.md",sourceDirName:"howtos/customization",slug:"/howtos/customization/provision_external_ip_for_local_kubernetes",permalink:"/1.10.0/howtos/customization/provision_external_ip_for_local_kubernetes",draft:!1,editUrl:"https://github.com/epinio/docs/edit/main/versioned_docs/version-1.10.0/howtos/customization/provision_external_ip_for_local_kubernetes.md",tags:[],version:"1.10.0",sidebarPosition:5,frontMatter:{sidebar_label:"Provisioning Of An External IP Address For Local Kubernetes",sidebar_position:5,title:""},sidebar:"docs",previous:{title:"AWS IAM integration",permalink:"/1.10.0/howtos/operations/aws_iam_integration"},next:{title:"Setting Up External S3 Storage",permalink:"/1.10.0/howtos/customization/setup_external_s3"}},p={},u=[{value:"Provision of External IP for LoadBalancer service type in Kubernetes",id:"provision-of-external-ip-for-loadbalancer-service-type-in-kubernetes",level:2},{value:"K3s/K3d",id:"k3sk3d",level:3},{value:"Kind",id:"kind",level:3},{value:"MicroK8s",id:"microk8s",level:3},{value:"Digital Ocean",id:"digital-ocean",level:3}],d={toc:u};function f(e){var t=e.components,n=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"provision-of-external-ip-for-loadbalancer-service-type-in-kubernetes"},"Provision of External IP for LoadBalancer service type in Kubernetes"),(0,i.kt)("p",null,"Some platforms for deploying local Kubernetes clusters do not have the ability\nto provide external IP addresses when creating Kubernetes services with service\ntype ",(0,i.kt)("inlineCode",{parentName:"p"},"LoadBalancer"),". The following steps will enable this ability for various\nplatforms. Follow these steps before installing Epinio."),(0,i.kt)("h3",{id:"k3sk3d"},"K3s/K3d"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Provision of LoadBalancer IP is enabled by default.")),(0,i.kt)("h3",{id:"kind"},"Kind"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Install JQ from ",(0,i.kt)("a",{parentName:"p",href:"https://stedolan.github.io/jq/download/"},"https://stedolan.github.io/jq/download/"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Install and configure MetalLB "))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.5/manifests/namespace.yaml\nkubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.5/manifests/metallb.yaml\nkubectl create secret generic -n metallb-system memberlist --from-literal=secretkey="$(openssl rand -base64 128)"\n\nSUBNET_IP=`docker network inspect kind | jq -r \'.[0].IPAM.Config[0].Gateway\'`\n## Use the last few IP addresses\nIP_ARRAY=(${SUBNET_IP//./ })\nSUBNET_IP="${IP_ARRAY[0]}.${IP_ARRAY[1]}.255.255"\n\ncat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  namespace: metallb-system\n  name: config\ndata:\n  config: |\n    address-pools:\n    - name: default\n      protocol: layer2\n      addresses:\n      - ${SUBNET_IP}/28\nEOF\n')),(0,i.kt)("h3",{id:"microk8s"},"MicroK8s"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Install and configure MetalLB")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"INTERFACE=`ip route | grep default | awk '{print $5}'`\nIP=`ifconfig $INTERFACE | sed -n '2 p' | awk '{print $2}'`\nmicrok8s enable metallb:${IP}/16\n")),(0,i.kt)("h3",{id:"digital-ocean"},"Digital Ocean"),(0,i.kt)("p",null,"When installing Epinio on Rancher-provisioned RKE2 or RKE1\nclusters on Digital Ocean, you might see this error message:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"error installing Epinio:\ntimed out waiting for LoadBalancer IP on traefik service\nEnsure your kubernetes platform has the ability to provision a LoadBalancer IP address.\n")),(0,i.kt)("p",null,"In this case it is necessary to configure RKE/RKE2 with an external cloud\nprovider such as the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/digitalocean/digitalocean-cloud-controller-manager"},"Digital Ocean CC Manager"),"."))}f.isMDXComponent=!0}}]);