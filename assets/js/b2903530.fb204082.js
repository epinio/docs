"use strict";(self.webpackChunkepinio_docusaurus=self.webpackChunkepinio_docusaurus||[]).push([[46213],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),m=o,g=d["".concat(c,".").concat(m)]||d[m]||u[m]||i;return n?r.createElement(g,a(a({ref:t},p),{},{components:n})):r.createElement(g,a({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var l=2;l<i;l++)a[l]=n[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},82063:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return u}});var r=n(83117),o=n(80102),i=(n(67294),n(3905)),a=["components"],s={sidebar_label:"Setting up an external container registry",sidebar_position:8,title:"How to set up an external container registry",description:"How to setup an external container registry",keywords:["epinio","kubernetes","external container registry setup"],"doc-type":["how-to"],"doc-topic":["epinio","how-to","custom","setup-external-container-registry"],"doc-persona":["epinio-operator"]},c=void 0,l={unversionedId:"howtos/customization/setup_external_registry",id:"howtos/customization/setup_external_registry",title:"How to set up an external container registry",description:"How to setup an external container registry",source:"@site/docs/howtos/customization/setup_external_registry.md",sourceDirName:"howtos/customization",slug:"/howtos/customization/setup_external_registry",permalink:"/next/howtos/customization/setup_external_registry",draft:!1,editUrl:"https://github.com/epinio/docs/edit/main/docs/howtos/customization/setup_external_registry.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_label:"Setting up an external container registry",sidebar_position:8,title:"How to set up an external container registry",description:"How to setup an external container registry",keywords:["epinio","kubernetes","external container registry setup"],"doc-type":["how-to"],"doc-topic":["epinio","how-to","custom","setup-external-container-registry"],"doc-persona":["epinio-operator"]},sidebar:"docs",previous:{title:"Setting up an export destination registry",permalink:"/next/howtos/customization/setup_export_registry"},next:{title:"Setting up routing secrets",permalink:"/next/howtos/customization/setup_routing_secrets"}},p={},u=[{value:"Advanced setup for a secure external registry",id:"advanced-setup-for-a-secure-external-registry",level:2}],d={toc:u};function m(e){var t=e.components,n=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"You can use an external registry for Epinio to store application images.\nYou can do this by setting the following variables during the ",(0,i.kt)("inlineCode",{parentName:"p"},"helm install"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"helm install \\\n  --set containerregistry.enabled=false \\\n  --set global.registryURL=$REGISTRY_URL \\\n  --set global.registryNamespace=$REGISTRY_NAMESPACE \\\n  --set global.registryUsername=$REGISTRY_USER \\\n  --set global.registryPassword=$REGISTRY_PASSWORD \\\n  ... (other options here) \\\n  epinio epinio/epinio\n")),(0,i.kt)("p",null,"Using ",(0,i.kt)("a",{parentName:"p",href:"https://hub.docker.com/"},"Docker Hub")," as an example, you would have to set\nthe value of ",(0,i.kt)("inlineCode",{parentName:"p"},"$REGISTRY_URL")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"registry.hub.docker.com"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"$REGISTRY_USER")," and\n",(0,i.kt)("inlineCode",{parentName:"p"},"$REGISTRY_PASSWORD")," are set to the Docker Hub credentials.\nLastly, ",(0,i.kt)("inlineCode",{parentName:"p"},"$REGISTRY_NAMESPACE"),"\nwould be either an organization or username."),(0,i.kt)("p",null,"With these arguments set, Epinio doesn't deploy a registry on the cluster."),(0,i.kt)("h2",{id:"advanced-setup-for-a-secure-external-registry"},"Advanced setup for a secure external registry"),(0,i.kt)("p",null,"When access to the external registry is secured via TLS it's necessary to make the correct certificate known to both Epinio and the cluster (that is, the kubelets)."),(0,i.kt)("p",null,"Assuming that ",(0,i.kt)("inlineCode",{parentName:"p"},"epinio-external-registry-tls")," is the name of the Kubernetes secret used to store the certificate then adding to the ",(0,i.kt)("inlineCode",{parentName:"p"},"helm install")," command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"    --set containerregistry.certificateSecret=epinio-external-registry-tls\n")),(0,i.kt)("p",null,"is enough to make the certificate known to Epinio."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"The secret needs to be in the ",(0,i.kt)("inlineCode",{parentName:"p"},"epinio")," namespace.\nThe certificate needs to be under the key ",(0,i.kt)("inlineCode",{parentName:"p"},"tls.crt")," of that secret\nand needs to be in PEM format.")),(0,i.kt)("p",null,"Making the same information known to the cluster itself, that is, the kubelets, differs between distributions of Kubernetes."),(0,i.kt)("p",null,"Assuming a k3s cluster running on an openSUSE or SLE-based host, and the certificate is in a file named ",(0,i.kt)("inlineCode",{parentName:"p"},"CA.pem"),", in the current working directory the commands would be:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"sudo cp CA.pem /etc/pki/trust/anchors/\nsudo update-ca-certificates\nsudo systemctl restart k3s[-agent].service\n")))}m.isMDXComponent=!0}}]);