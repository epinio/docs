"use strict";(self.webpackChunkepinio_docusaurus=self.webpackChunkepinio_docusaurus||[]).push([[40710],{3905:function(e,t,n){n.d(t,{Zo:function(){return l},kt:function(){return d}});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=r.createContext({}),c=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},l=function(e){var t=c(e.components);return r.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,p=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),m=c(n),d=o,h=m["".concat(p,".").concat(d)]||m[d]||u[d]||i;return n?r.createElement(h,a(a({ref:t},l),{},{components:n})):r.createElement(h,a({ref:t},l))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var c=2;c<i;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},74954:function(e,t,n){n.r(t),n.d(t,{assets:function(){return l},contentTitle:function(){return p},default:function(){return d},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var r=n(83117),o=n(80102),i=(n(67294),n(3905)),a=["components"],s={sidebar_label:"Setting up routing secrets",sidebar_position:10,title:"Setting up routing secrets for use by applications",description:"How to set up routing secrets for use by applications",keywords:["epinio","kubernetes","setup routing secrets"],"doc-type":["how-to"],"doc-topic":["epinio","how-to","custom","setup-routing-secrets"],"doc-persona":["epinio-operator"]},p=void 0,c={unversionedId:"howtos/customization/setup_routing_secrets",id:"howtos/customization/setup_routing_secrets",title:"Setting up routing secrets for use by applications",description:"How to set up routing secrets for use by applications",source:"@site/docs/howtos/customization/setup_routing_secrets.md",sourceDirName:"howtos/customization",slug:"/howtos/customization/setup_routing_secrets",permalink:"/next/howtos/customization/setup_routing_secrets",draft:!1,editUrl:"https://github.com/epinio/docs/edit/main/docs/howtos/customization/setup_routing_secrets.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_label:"Setting up routing secrets",sidebar_position:10,title:"Setting up routing secrets for use by applications",description:"How to set up routing secrets for use by applications",keywords:["epinio","kubernetes","setup routing secrets"],"doc-type":["how-to"],"doc-topic":["epinio","how-to","custom","setup-routing-secrets"],"doc-persona":["epinio-operator"]},sidebar:"docs",previous:{title:"Setting up an external container registry",permalink:"/next/howtos/customization/setup_external_registry"},next:{title:"Setting up custom routes",permalink:"/next/howtos/customization/custom_routes"}},l={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Creating a routing secret",id:"creating-a-routing-secret",level:2},{value:"Issues and solutions",id:"issues-and-solutions",level:2}],m={toc:u};function d(e){var t=e.components,n=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This is a How-to for operators."),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"In regular operation Epinio automatically creates the ",(0,i.kt)("inlineCode",{parentName:"p"},"kubernetes.io/tls")," Secrets needed by a new application's Ingress to secure communication with that application."),(0,i.kt)("p",null,"The application chart used to deploy that application creates both the ",(0,i.kt)("inlineCode",{parentName:"p"},"Ingress")," and a ",(0,i.kt)("inlineCode",{parentName:"p"},"Certificate")," resource for it.\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"Certificate")," resource is then picked up by the Cert manager component, which in turn creates the Secret that holds the certificate data."),(0,i.kt)("p",null,"There's a window where the Ingress isn't secured due to the time needed to see the new Certificate and then create the associated Secret."),(0,i.kt)("p",null,"This situation can be worse if using an external provider for certificates, for example, ",(0,i.kt)("a",{parentName:"p",href:"https://letsencrypt.org/"},"Let's Encrypt"),", which may impose rate limits, lengthening the time window."),(0,i.kt)("p",null,"Epinio ",(0,i.kt)("inlineCode",{parentName:"p"},"routing secrets")," are an (optional) means to side-step these issues by creating secrets ahead of deploying the applications using them."),(0,i.kt)("h2",{id:"creating-a-routing-secret"},"Creating a routing secret"),(0,i.kt)("p",null,"The steps to create a routing secret suitable for Epinio are:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create a regular ",(0,i.kt)("inlineCode",{parentName:"p"},"kubernetes.io/tls")," Secret, for a domain ",(0,i.kt)("inlineCode",{parentName:"p"},"D"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Mark the resulting secret with the label ",(0,i.kt)("inlineCode",{parentName:"p"},"epinio.io/routing"),".\nThe value of that label isn't relevant, just its presence.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Deploy an application into the namespace containing the marked secret, and requesting\na route for domain ",(0,i.kt)("inlineCode",{parentName:"p"},"D"),"."))),(0,i.kt)("p",null,"Epinio now sees that there is a secret for ",(0,i.kt)("inlineCode",{parentName:"p"},"D")," in the namespace and passes the name of the secret to the application chart responsible for deployment."),(0,i.kt)("p",null,"The chart now creates an ",(0,i.kt)("inlineCode",{parentName:"p"},"Ingress")," directly referencing that secret and skips the creation of a ",(0,i.kt)("inlineCode",{parentName:"p"},"Certificate")," for it."),(0,i.kt)("h2",{id:"issues-and-solutions"},"Issues and solutions"),(0,i.kt)("p",null,"When using routing secrets, a manual process replaces a fully automatic one.\nThe load normally placed on the Cert manager component and the providers backing it, now belongs to the operator.\nThe operator now creates Certificates and Secrets, placing them in the relevant namespaces, etc."),(0,i.kt)("p",null,"There are mitigating factors however:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Routing secrets are ",(0,i.kt)("strong",{parentName:"p"},"optional"),".\nUse them only where absolutely necessary with everything else keeping to the automatic process.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Routing secrets may hold certificates for ",(0,i.kt)("strong",{parentName:"p"},"wildcard domains"),".\nThe secret is used whenever a requested application route matches the wildcard pattern.\nThis reduces the number of Secrets needing creation.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"You can automate distribution of routing secrets by using a component like Kubed.\nKubed can automatically copy secrets between namespaces based on annotations.\nKubed is a component of Epinio so is available.\nAs an example,"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Place a new routing secret ",(0,i.kt)("inlineCode",{parentName:"p"},"RS")," into the namespace ",(0,i.kt)("inlineCode",{parentName:"p"},"epinio"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Annotate the secret with"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},'kubed.appscode.com/sync="app.kubernetes.io/component=epinio-namespace"'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Kubed now distributes ",(0,i.kt)("inlineCode",{parentName:"p"},"RS")," to all namespaces which have the label ",(0,i.kt)("inlineCode",{parentName:"p"},"app.kubernetes.io/component=epinio-namespace"),".\nThese are all the namespaces under Epinio's control."),(0,i.kt)("p",{parentName:"li"},"For a more limited distribution it's possible to add custom labels to the\ndesired namespaces and add matching annotations on the relevant Secrets."),(0,i.kt)("p",{parentName:"li"},"The distribution automatically includes all new namespaces\nmatching whatever criteria are in place."))))))}d.isMDXComponent=!0}}]);